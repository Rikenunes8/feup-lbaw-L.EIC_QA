function addEventListeners(){let e=document.querySelectorAll("div.uc-card p.uc-card-icon a.uc-card-icon-follow");[].forEach.call(e,function(e){follower.addEventListener("click",sendFollowUcRequest)});let t=document.querySelectorAll("td.admin-table-uc-actions a.admin-table-delete");[].forEach.call(t,function(e){e.addEventListener("click",sendDeleteUcRequest)});let n=document.querySelectorAll("td.admin-table-teacher-actions a.admin-table-remove");[].forEach.call(n,function(e){e.addEventListener("click",sendRemoveUcTeacherRequest)});let i=document.querySelectorAll("td.admin-table-teacher-actions a.admin-table-add");[].forEach.call(i,function(e){e.addEventListener("click",sendAddUcTeacherRequest)});let a=document.querySelectorAll("td.admin-table-user-actions a.admin-table-delete");[].forEach.call(a,function(e){e.addEventListener("click",sendDeleteUserRequest)});let s=document.querySelectorAll("td.admin-table-user-actions a.admin-table-block");[].forEach.call(s,function(e){e.addEventListener("click",sendBlockUserRequest)});let o=document.querySelectorAll("td.admin-table-user-actions a.admin-table-active");[].forEach.call(o,function(e){e.addEventListener("click",sendActiveUserRequest)});let r=document.querySelectorAll("section#admin-requests-page a.admin-table-active-all");[].forEach.call(r,function(e){e.addEventListener("click",sendActiveAllUserRequest)});let l=document.querySelectorAll("section#admin-requests-page a.admin-table-reject-all");[].forEach.call(l,function(e){e.addEventListener("click",sendRejectAllUserRequest)});let d=document.querySelectorAll(".intervention-detail div.question-page-actions-modals a.question-page-delete");[].forEach.call(d,function(e){e.addEventListener("click",sendDeleteInterventionRequest)});let c=document.querySelectorAll(".intervention-detail .intervention-votes a.intervention-upvote");[].forEach.call(c,function(e){e.addEventListener("click",sendUpVoteInterventionRequest)});let u=document.querySelectorAll(".intervention-detail .intervention-votes a.intervention-downvote");[].forEach.call(u,function(e){e.addEventListener("click",sendDownVoteInterventionRequest)});let m=document.querySelectorAll(".intervention-detail .question-card-icon-validate a.validate-valid");[].forEach.call(m,function(e){e.addEventListener("click",sendValidAnswerRequest)});let f=document.querySelectorAll(".intervention-detail .question-card-icon-validate a.validate-invalid");[].forEach.call(f,function(e){e.addEventListener("click",sendInvalidAnswerRequest)});let p=document.querySelectorAll(".intervention-detail .question-card-icon-validate a.invalidate");[].forEach.call(p,function(e){e.addEventListener("click",sendNoneAnswerRequest)});let v=document.querySelectorAll("#question-page .intervention-detail a.question-page-report");[].forEach.call(v,function(e){e.addEventListener("click",sendInterventionReportRequest)});let h=document.querySelectorAll(".notification-card .notifications-page-actions a.notifications-page-envelope");[].forEach.call(h,function(e){e.addEventListener("click",sendMarkReadNotificationRequest)});let q=document.querySelectorAll(".notification-card .notifications-page-actions a.notifications-page-remove");[].forEach.call(q,function(e){e.addEventListener("click",sendRemoveNotificationRequest)});let b=document.querySelectorAll("td.admin-table-reports-actions a.reports-page-remove");[].forEach.call(b,function(e){e.addEventListener("click",sendRemoveReportRequest)});let A=document.querySelectorAll("#user-profile-page div.form-switch input");[].forEach.call(A,function(e){e.addEventListener("click",switchReceiveEmailRequest)});[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]')).map(function(e){return new bootstrap.Popover(e)})}function encodeForAjax(e){return null==e?null:Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}function sendAjaxRequest(e,t,n,i){let a=new XMLHttpRequest;a.open(e,t,!0),a.setRequestHeader("X-CSRF-TOKEN",document.querySelector('meta[name="csrf-token"]').content),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.addEventListener("load",i),a.send(encodeForAjax(n))}function sendFollowUcRequest(){let e=this.closest("section#ucs-page, section#uc-page, div.user-profile").getAttribute("data-id"),t=this.closest("div.uc-card").getAttribute("data-id");sendAjaxRequest("post","/api/users/"+e+"/follow/"+t,{follow:document.querySelector('div.uc-card[data-id="'+t+'"] a.uc-card-icon-follow i').classList.contains("far")},ucFollowHandler)}function sendDeleteUcRequest(){sendAjaxRequest("delete","/api/ucs/"+this.closest("tr").getAttribute("data-id")+"/delete",null,ucDeletedHandler)}function sendRemoveUcTeacherRequest(){sendAjaxRequest("delete","/api/ucs/"+this.closest("table").getAttribute("data-id")+"/teachers/"+this.closest("tr").getAttribute("data-id")+"/remove",null,ucTeacherRemovedHandler)}function sendAddUcTeacherRequest(){sendAjaxRequest("put","/api/ucs/"+this.closest("table").getAttribute("data-id")+"/teachers/"+this.closest("tr").getAttribute("data-id")+"/add",null,ucTeacherAddedHandler)}function sendDeleteUserRequest(){sendAjaxRequest("delete","/api/users/"+this.closest("tr").getAttribute("data-id")+"/delete",null,userDeletedHandler)}function sendBlockUserRequest(e){let t=this.closest("tr"),n=t.getAttribute("data-id"),i=t.querySelector("input[name=reason]").value;if(""!=i)sendAjaxRequest("post","/api/users/"+n+"/block",{block_reason:i},userBlockedHandler);else{document.querySelector("div.error-msg").appendChild(createAlert("alert-danger","Não é possível bloquear um utilizador sem uma razão."))}e.preventDefault()}function sendActiveUserRequest(){sendAjaxRequest("post","/api/users/"+this.closest("tr").getAttribute("data-id")+"/active",null,userActivatedHandler)}function sendActiveAllUserRequest(){document.querySelectorAll("table#admin-table tbody tr").forEach(e=>{if(e.hasAttribute("data-id")){sendAjaxRequest("post","/api/users/"+e.getAttribute("data-id")+"/active",null,userActivatedHandler)}})}function sendRejectAllUserRequest(){document.querySelectorAll("table#admin-table tbody tr").forEach(e=>{if(e.hasAttribute("data-id")){sendAjaxRequest("delete","/api/users/"+e.getAttribute("data-id")+"/delete",null,userDeletedHandler)}})}function sendDeleteInterventionRequest(){sendAjaxRequest("delete","/api/interventions/"+this.closest("section").getAttribute("data-id")+"/delete",null,interventionDeletedHandler)}function sendUpVoteInterventionRequest(){sendAjaxRequest("post","/api/interventions/"+this.closest("section").getAttribute("data-id")+"/vote",{vote:!0},interventionVotedHandler)}function sendDownVoteInterventionRequest(){sendAjaxRequest("post","/api/interventions/"+this.closest("section").getAttribute("data-id")+"/vote",{vote:!1},interventionVotedHandler)}function sendValidAnswerRequest(){sendAjaxRequest("post","/api/interventions/"+this.closest("section").getAttribute("data-id")+"/validate",{valid:!0},answerValidatedHandler)}function sendInvalidAnswerRequest(){sendAjaxRequest("post","/api/interventions/"+this.closest("section").getAttribute("data-id")+"/validate",{valid:!1},answerValidatedHandler)}function sendNoneAnswerRequest(){sendAjaxRequest("post","/api/interventions/"+this.closest("section").getAttribute("data-id")+"/validate",{valid:null},answerValidatedHandler)}function sendInterventionReportRequest(){sendAjaxRequest("post","/api/interventions/"+this.closest("section").getAttribute("data-id")+"/report",{valid:null},interventionReportHandler)}function sendMarkReadNotificationRequest(){let e=this.closest("div.notification-card");sendAjaxRequest("post","/api/notifications/"+e.getAttribute("data-id")+"/read",{read:e.classList.contains("notification-read")},notificationMarkReadHandler)}function sendRemoveNotificationRequest(){sendAjaxRequest("post","/api/notifications/"+this.closest("div.notification-card").getAttribute("data-id")+"/remove",null,notificationRemoveHandler)}function sendRemoveReportRequest(){sendAjaxRequest("post","/api/notifications/"+this.closest("tr").getAttribute("data-id")+"/remove",null,reportRemovedHandler)}function switchReceiveEmailRequest(){sendAjaxRequest("post","/api/users/"+this.closest("div.user-profile").getAttribute("data-id")+"/email",null,switchReceiveEmailHandler)}function ucFollowHandler(){if(403==this.status){return void document.querySelector("div.error-msg").appendChild(createAlert("alert-danger","Ação não autorizada"))}200!=this.status&&(window.location="/");let e=JSON.parse(this.responseText),t=document.querySelector('div.uc-card[data-id="'+e.id+'"] a.uc-card-icon-follow i');t.classList.contains("fas")?t.classList.replace("fas","far"):t.classList.replace("far","fas")}function ucDeletedHandler(){200!=this.status&&(window.location="/");let e=JSON.parse(this.responseText),t=document.querySelector('tr[data-id="'+e.id+'"]');t.remove(),admin_table.row(t).remove().draw(!1)}function ucTeacherRemovedHandler(){200!=this.status&&(window.location="/");let e=JSON.parse(this.responseText),t=document.querySelector('tr[data-id="'+e.id+'"] td.admin-table-teacher-actions');t.removeChild(t.lastElementChild);let n=document.createElement("a");n.classList.add("btn","btn-primary","text-white","admin-table-add"),n.setAttribute("data-toogle","tooltip"),n.setAttribute("title","Associar Docente"),n.innerHTML='<i class="fas fa-plus"></i> <span class="d-none">Adicionar</span>',n.addEventListener("click",sendAddUcTeacherRequest),t.appendChild(n)}function ucTeacherAddedHandler(){200!=this.status&&(window.location="/");let e=JSON.parse(this.responseText),t=document.querySelector('tr[data-id="'+e.id+'"] td.admin-table-teacher-actions');t.removeChild(t.lastElementChild);let n=document.createElement("a");n.classList.add("btn","btn-danger","text-white","admin-table-remove"),n.setAttribute("data-toogle","tooltip"),n.setAttribute("title","Desassociar Docente"),n.innerHTML='<i class="fas fa-minus"></i> <span class="d-none">Remover</span>',n.addEventListener("click",sendRemoveUcTeacherRequest),t.appendChild(n)}function userDeletedHandler(){200!=this.status&&(window.location="/");let e=JSON.parse(this.responseText),t=document.querySelector('tr[data-id="'+e.id+'"]');t.remove(),admin_table.row(t).remove().draw(!1)}function userBlockedHandler(){200!=this.status&&(window.location="/");let e=JSON.parse(this.responseText),t=document.querySelector('tr[data-id="'+e.id+'"] input[name=reason]');t.disabled=e.blocked,e.blocked||(t.value="");let n=document.querySelector('tr[data-id="'+e.id+'"] td.admin-table-user-actions button.block-btn'),i=n.querySelector("i"),a=n.querySelector("span");e.blocked?(n.classList.replace("btn-info","btn-dark"),n.classList.replace("text-dark","text-white"),i.classList.replace("fa-lock","fa-unlock"),a.innerHTML="Unlock"):(n.classList.replace("btn-dark","btn-info"),n.classList.replace("text-white","text-dark"),i.classList.replace("fa-unlock","fa-lock"),a.innerHTML="Lock")}function userActivatedHandler(){200!=this.status&&(window.location="/");let e=JSON.parse(this.responseText),t=document.querySelector('tr[data-id="'+e.id+'"]');t.remove(),document.querySelector("div.error-msg").appendChild(createAlert("alert-success","Conta '"+e.email+"' ativada com sucesso!")),admin_table.row(t).remove().draw(!1)}function interventionDeletedHandler(){if(403==this.status){return void document.querySelector("div.error-msg").appendChild(createAlert("alert-danger","Eliminação não autorizada"))}200!=this.status&&(window.location="/");let e=JSON.parse(this.responseText),t=document.querySelector('section.intervention-detail[data-id="'+e.id+'"]');if(t.classList.contains("question-detail"))location.reload();else if(t.classList.contains("answer-detail")){t.remove();let n=document.querySelectorAll("section.comment-parent-"+e.id);[].forEach.call(n,function(e){e.remove()})}else t.remove()}function interventionVotedHandler(){if(403==this.status){return void document.querySelector("div.error-msg").appendChild(createAlert("alert-danger","Votação não autorizada"))}200!=this.status&&(window.location="/");let e=JSON.parse(this.responseText);document.querySelector('section.intervention-detail[data-id="'+e.id+'"] .intervention-votes-number').innerHTML=e.votes}function answerValidatedHandler(){if(403==this.status){return void document.querySelector("div.error-msg").appendChild(createAlert("alert-danger","Validação não autorizada"))}200!=this.status&&(window.location="/");let e=JSON.parse(this.responseText),t=e[0],n=e[1],i=document.querySelector('.answer-detail[data-id="'+t.id+'"] div.question-card-icon-validate');i.innerHTML="";let a=document.createElement("a");a.setAttribute("class","btn btn-outline-success text-success me-1 validate-valid"),a.setAttribute("data-toogle","tooltip"),a.setAttribute("title","Validar"),a.innerHTML='<i class="fas fa-check"></i>',a.addEventListener("click",sendValidAnswerRequest);let s=document.createElement("a");s.setAttribute("class","btn btn-outline-danger text-danger me-1 validate-invalid"),s.setAttribute("data-toogle","tooltip"),s.setAttribute("title","Invalidar"),s.innerHTML='<i class="fas fa-times"></i>',s.addEventListener("click",sendInvalidAnswerRequest);let o=document.createElement("a");o.setAttribute("class","btn text-white invalidate me-1"),o.setAttribute("data-toogle","tooltip"),o.innerHTML='<i class="fas '+(n?"fa-check":"fa-times")+'"></i>',o.addEventListener("click",sendNoneAnswerRequest),null==n?(i.appendChild(a),i.appendChild(s)):n?(o.classList.add("btn-success"),o.setAttribute("title","Remover Validação"),i.appendChild(o),i.appendChild(s)):(i.appendChild(a),o.classList.add("btn-danger"),o.setAttribute("title","Remover Invalidação"),i.appendChild(o))}function interventionReportHandler(){let e=document.querySelector("div.error-msg");if(403==this.status)return void e.appendChild(createAlert("alert-danger","Denúncia não autorizada"));200!=this.status&&(window.location="/");JSON.parse(this.responseText);e.appendChild(createAlert("alert-success","Denúncia realizada com sucesso!"))}function notificationMarkReadHandler(){if(403==this.status){return void document.querySelector("div.error-msg").appendChild(createAlert("alert-danger","Ação não autorizada"))}200!=this.status&&(window.location="/");let e=JSON.parse(this.responseText),t=document.querySelector('div.notification-card[data-id="'+e.id+'"]'),n=t.querySelector("a.notifications-page-envelope i"),i=document.querySelector("#header-notification-icon span");t.classList.contains("notification-read")?(t.classList.replace("notification-read","notification-unread"),n.classList.replace("fa-envelope","fa-envelope-open"),""==i.innerHTML?i.innerHTML=1:"+99"!=i.innerHTML&&(i.innerHTML=parseInt(i.innerHTML)+1),i.innerHTML>=100&&(i.innerHTML="+99")):(t.classList.replace("notification-unread","notification-read"),n.classList.replace("fa-envelope-open","fa-envelope"),i.innerHTML-=1,0==i.innerHTML&&(i.innerHTML=""))}function notificationRemoveHandler(){if(403==this.status){return void document.querySelector("div.error-msg").appendChild(createAlert("alert-danger","Ação não autorizada"))}200!=this.status&&(window.location="/");let e=JSON.parse(this.responseText),t=document.querySelector('div.notification-card[data-id="'+e.id+'"]'),n=t.closest("section"),i=document.querySelector("#header-notification-icon span");t.classList.contains("notification-unread")&&(i.innerHTML-=1),0==i.innerHTML&&(i.innerHTML=""),n.remove()}function reportRemovedHandler(){if(403==this.status){return void document.querySelector("div.error-msg").appendChild(createAlert("alert-danger","Ação não autorizada"))}200!=this.status&&(window.location="/");let e=JSON.parse(this.responseText),t=document.querySelector('tr[data-id="'+e.id+'"]');t.remove(),admin_table.row(t).remove().draw(!1)}function switchReceiveEmailHandler(){if(403!=this.status)200!=this.status&&(window.location="/");else{document.querySelector("div.error-msg").appendChild(createAlert("alert-danger","Ação não autorizada"))}}function focusSearchInput(){document.querySelector("input#search-input").focus()}function focusAnswerInput(){tinyMCE.get("answer-textarea").focus()}function showRegisterFormFields(){const e=document.querySelector("select#usertype");if(null===e)return;const t=e.value;let n=document.querySelectorAll("div.teacher-student-extra-fields"),i=document.querySelectorAll("div.student-extra-fields"),a=document.querySelector("input#name"),s=document.querySelector("input#entryyear"),o=document.querySelector("textarea#about");switch(t){case"Admin":[].forEach.call(n,function(e){e.classList.add("d-none")}),[].forEach.call(i,function(e){e.classList.add("d-none")}),a.required=!1,s.required=!1;break;case"Teacher":[].forEach.call(n,function(e){e.classList.remove("d-none")}),[].forEach.call(i,function(e){e.classList.add("d-none")}),a.required=!0,s.required=!1,o.setAttribute("rows","8");break;case"Student":[].forEach.call(n,function(e){e.classList.remove("d-none")}),[].forEach.call(i,function(e){e.classList.remove("d-none")}),a.required=!0,s.required=!0,o.setAttribute("rows","11")}}function showCommentCreateForm(e){let t=e.getAttribute("data-value"),n=document.querySelector("section#comment-answer-form-"+t);n.classList.contains("d-none")?(n.classList.replace("d-none","d-flex"),n.classList.add("flex-row-reverse")):(n.classList.remove("flex-row-reverse"),n.classList.replace("d-flex","d-none"))}function showFilterForm(){let e=document.querySelector("div.filter-card");e.classList.contains("d-none")?e.classList.replace("d-none","d-block"):e.classList.replace("d-block","d-none")}function createAlert(e,t){let n=document.createElement("div");n.classList.add("mt-1","py-2","alert",e,"alert-dismissible","fade","show");let i=document.createElement("button");i.setAttribute("type","button"),i.setAttribute("data-bs-dismiss","alert"),i.classList.add("h-auto","btn-close","btn-sm");let a=document.createTextNode(`${t}`);return n.appendChild(i),n.appendChild(a),window.setTimeout(function(){$(n).fadeTo(500,0).slideUp(500,function(){this.remove()})},4e3),n}function getUrlVars(){var e={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,n,i){e[n]=i});return e}function formatDetails(e){const t=JSON.parse(e);return'<div class="row mt-4"><div class="col-2"><img src="'+(null!=t.photo?"/images/users/"+t.photo:"/images/users/default.jpg")+'" alt="profile-photo-big" id="profile-photo-big" class="d-block w-100"></div><div class="col-10"><h5>Sobre mim</h5><div class="ms-3"><p>Apresentação: '+(null!=t.about?t.about:"Não definida")+'</p><p><i class="fas fa-birthday-cake me-2"></i>Aniversário: '+(null!=t.birthdate?t.birthdate.substring(0,10):"Não definido")+"</p>"+("Student"!=t.type?"":'<p><i class="fas fa-user-graduate me-2"></i>Ano de Ingresso: '+t.entry_year+"</p>")+"</div></div></div>"}var admin_table;addEventListeners(),$(document).ready(function(){admin_table=$("#admin-table").DataTable({page:1,pagingType:"simple_numbers",initComplete:function(){void 0!==getUrlVars().searchDt&&this.api().search(decodeURI(getUrlVars().searchDt)).draw()}}),$(".dataTables_length").addClass("bs-select"),$("#admin-table tbody").on("click","td.expand-button",function(){var e=$(this).closest("tr"),t=admin_table.row(e);t.child.isShown()?($(this).html("+"),t.child.hide(),e.removeClass("shown")):($(this).html("-"),t.child(formatDetails(e.attr("data-details"))).show(),e.addClass("shown"))}),$(".filter-ucs-multiple").select2(),tinymce.init({selector:"textarea.text-editor",menubar:!1,toolbar_sticky:!0,toolbar:"undo redo | styleselect | bold italic underline strikethrough | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist | table codesample link | fullscreen",plugins:"autolink link codesample advlist lists table fullscreen",style_formats:[{title:"Headings",items:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Superscript",format:"superscript"},{title:"Subscript",format:"subscript"},{title:"Code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"}]}]}),showRegisterFormFields()}),$("#deleteUserModal a").on("click",function(e){var t=$(e.target);e.preventDefault(),$(this).closest(".modal").on("hidden.bs.modal",function(e){var n=t.attr("href");window.location.href=n})}),$("#user-profile-tabs.nav .nav-link").on("click",function(){$("#user-profile-tabs.nav").find(".active").removeClass("active"),$(this).addClass("active")}),window.setTimeout(function(){$(".alert").fadeTo(500,0).slideUp(500,function(){this.remove()})},4e3);